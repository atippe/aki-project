=== Starting new training run ===
Crypto Currency: btc

Model Parameters:
  hidden_size: 128
  num_layers: 2
  dropout: 0.2
  num_epochs: 50
  batch_size: 32
  learning_rate: 0.001
  device: cpu
  weight_decay: 1e-05
  betas: (0.9, 0.999)
  eps: 1e-08
  criterion: MSE
Loading pre-processed data...

=== Dataset Configuration ===
Sequence length: 60
Feature count: 5
Feature indices: {'Volume': 0, 'Open': 1, 'High': 2, 'Low': 3, 'Close': 4}
Close price index: 4

=== Data Shapes ===
Training set shape: torch.Size([3316, 60, 5])
Validation set shape: torch.Size([663, 60, 5])
Test set shape: torch.Size([664, 60, 5])

=== Date Range ===
Start date: 2011-08-18
End date: 2024-10-30

=== Feature Alignment Verification ===
Feature alignment test - Close position: 4
Inverse transform test shape: (1, 5)
Model input size: 5
Starting training process...
Starting training process
Model architecture:
AdvancedPricePredictionModel(
  (lstm): EnhancedLSTM(
    (input_embedding): Linear(in_features=5, out_features=128, bias=True)
    (lstm_cells): ModuleList(
      (0-1): 2 x CustomLSTMCell(
        (dropout): Dropout(p=0.2, inplace=False)
        (layer_norm_1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (layer_norm_2): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (gates): Linear(in_features=256, out_features=512, bias=True)
      )
    )
    (attention): AttentionLayer(
      (attention): Sequential(
        (0): Linear(in_features=128, out_features=128, bias=True)
        (1): Tanh()
        (2): Linear(in_features=128, out_features=1, bias=True)
      )
    )
    (positional_encoding): PositionalEncoding()
    (self_attention): MultiHeadSelfAttention(
      (q_linear): Linear(in_features=128, out_features=128, bias=True)
      (k_linear): Linear(in_features=128, out_features=128, bias=True)
      (v_linear): Linear(in_features=128, out_features=128, bias=True)
      (dropout): Dropout(p=0.1, inplace=False)
      (out): Linear(in_features=128, out_features=128, bias=True)
    )
    (glu): GatedLinearUnit(
      (linear): Linear(in_features=128, out_features=256, bias=True)
    )
    (temporal_conv): TemporalConvNet(
      (conv1): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
      (conv2): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
      (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    (skip_connections): ModuleList(
      (0-1): 2 x Linear(in_features=128, out_features=128, bias=True)
    )
  )
  (prediction_head): Sequential(
    (0): Linear(in_features=128, out_features=128, bias=True)
    (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    (2): ReLU()
    (3): Dropout(p=0.2, inplace=False)
    (4): Linear(in_features=128, out_features=64, bias=True)
    (5): ReLU()
    (6): Dropout(p=0.2, inplace=False)
    (7): Linear(in_features=64, out_features=1, bias=True)
  )
)
Training parameters: epochs=50, device=cpu
Optimizer: Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.001
    maximize: False
    weight_decay: 1e-05
)
Loss function: MSELoss()
Training batches: 104
Validation batches: 21

Starting Epoch [1/50]

First batch details:
Scaled predictions (first 3):
[[-0.43271253]
 [-0.02155086]
 [-0.19851965]]
Scaled targets (first 3):
[ 0.2779617  -0.01062396  0.9220781 ]
Price predictions (first 3):
[213.10647213 572.99531046 374.46741505]
Price targets (first 3):
[1176.3071544   588.23717611 5517.50037094]
Initial normalized MSE: 1.211139
Initial price-scale MSE: 22209697.36
Epoch [1/50] Summary:
  Normalized - Train MSE: 0.074073, RMSE: 0.272163
  Normalized - Val MSE: 0.379375, RMSE: 0.615934
  Price Scale - Train MSE: 8149467.93, RMSE: $2854.73
  Price Scale - Val MSE: 1101174097.91, RMSE: $33183.94

Starting Epoch [2/50]
Epoch [2/50] Summary:
  Normalized - Train MSE: 0.031660, RMSE: 0.177932
  Normalized - Val MSE: 0.269077, RMSE: 0.518726
  Price Scale - Train MSE: 5752817.11, RMSE: $2398.50
  Price Scale - Val MSE: 958943595.42, RMSE: $30966.81

Starting Epoch [3/50]
Epoch [3/50] Summary:
  Normalized - Train MSE: 0.026527, RMSE: 0.162870
  Normalized - Val MSE: 0.297118, RMSE: 0.545085
  Price Scale - Train MSE: 4611377.78, RMSE: $2147.41
  Price Scale - Val MSE: 1001537495.69, RMSE: $31647.08

Starting Epoch [4/50]
Epoch [4/50] Summary:
  Normalized - Train MSE: 0.024080, RMSE: 0.155178
  Normalized - Val MSE: 0.272216, RMSE: 0.521744
  Price Scale - Train MSE: 4955065.06, RMSE: $2226.00
  Price Scale - Val MSE: 965914557.77, RMSE: $31079.17

Starting Epoch [5/50]

Attention Pattern Sample (Epoch 5):
Average attention weights: [[0.00372518]
 [0.00479822]
 [0.00497141]
 [0.00482193]
 [0.00489443]]
Epoch [5/50] Summary:
  Normalized - Train MSE: 0.021818, RMSE: 0.147710
  Normalized - Val MSE: 0.130239, RMSE: 0.360887
  Price Scale - Train MSE: 4972289.20, RMSE: $2229.86
  Price Scale - Val MSE: 675397217.90, RMSE: $25988.41

Starting Epoch [6/50]
Epoch [6/50] Summary:
  Normalized - Train MSE: 0.019210, RMSE: 0.138601
  Normalized - Val MSE: 0.153136, RMSE: 0.391326
  Price Scale - Train MSE: 3915827.40, RMSE: $1978.84
  Price Scale - Val MSE: 734268129.84, RMSE: $27097.38

Starting Epoch [7/50]
Epoch [7/50] Summary:
  Normalized - Train MSE: 0.020376, RMSE: 0.142743
  Normalized - Val MSE: 0.119275, RMSE: 0.345363
  Price Scale - Train MSE: 3961589.78, RMSE: $1990.37
  Price Scale - Val MSE: 644228447.12, RMSE: $25381.66

Starting Epoch [8/50]
Epoch [8/50] Summary:
  Normalized - Train MSE: 0.019852, RMSE: 0.140896
  Normalized - Val MSE: 0.245879, RMSE: 0.495862
  Price Scale - Train MSE: 4280067.73, RMSE: $2068.83
  Price Scale - Val MSE: 918471609.48, RMSE: $30306.30

Starting Epoch [9/50]
Epoch [9/50] Summary:
  Normalized - Train MSE: 0.019976, RMSE: 0.141336
  Normalized - Val MSE: 0.169470, RMSE: 0.411667
  Price Scale - Train MSE: 4196037.41, RMSE: $2048.42
  Price Scale - Val MSE: 772502125.12, RMSE: $27793.92

Starting Epoch [10/50]

Attention Pattern Sample (Epoch 10):
Average attention weights: [[0.00192035]
 [0.00334767]
 [0.00325899]
 [0.00270067]
 [0.00257988]]
Epoch [10/50] Summary:
  Normalized - Train MSE: 0.018338, RMSE: 0.135416
  Normalized - Val MSE: 0.123298, RMSE: 0.351138
  Price Scale - Train MSE: 3516092.67, RMSE: $1875.12
  Price Scale - Val MSE: 655749688.77, RMSE: $25607.61

Starting Epoch [11/50]
Epoch [11/50] Summary:
  Normalized - Train MSE: 0.019087, RMSE: 0.138156
  Normalized - Val MSE: 0.156016, RMSE: 0.394989
  Price Scale - Train MSE: 3886067.42, RMSE: $1971.31
  Price Scale - Val MSE: 743011393.55, RMSE: $27258.24

Starting Epoch [12/50]
Epoch [12/50] Summary:
  Normalized - Train MSE: 0.016936, RMSE: 0.130140
  Normalized - Val MSE: 0.231701, RMSE: 0.481354
  Price Scale - Train MSE: 3718394.22, RMSE: $1928.31
  Price Scale - Val MSE: 897168959.92, RMSE: $29952.78

Starting Epoch [13/50]
Epoch [13/50] Summary:
  Normalized - Train MSE: 0.017364, RMSE: 0.131774
  Normalized - Val MSE: 0.135836, RMSE: 0.368559
  Price Scale - Train MSE: 3312491.66, RMSE: $1820.03
  Price Scale - Val MSE: 688863380.99, RMSE: $26246.21

Starting Epoch [14/50]
Epoch [14/50] Summary:
  Normalized - Train MSE: 0.017535, RMSE: 0.132418
  Normalized - Val MSE: 0.151863, RMSE: 0.389696
  Price Scale - Train MSE: 3748029.52, RMSE: $1935.98
  Price Scale - Val MSE: 731510962.42, RMSE: $27046.46

Starting Epoch [15/50]

Attention Pattern Sample (Epoch 15):
Average attention weights: [[0.00299453]
 [0.00390108]
 [0.00344954]
 [0.00294924]
 [0.00277267]]
Epoch [15/50] Summary:
  Normalized - Train MSE: 0.017684, RMSE: 0.132979
  Normalized - Val MSE: 0.166607, RMSE: 0.408175
  Price Scale - Train MSE: 3449608.35, RMSE: $1857.31
  Price Scale - Val MSE: 761541190.02, RMSE: $27596.04

Starting Epoch [16/50]
Epoch [16/50] Summary:
  Normalized - Train MSE: 0.019870, RMSE: 0.140960
  Normalized - Val MSE: 0.132518, RMSE: 0.364030
  Price Scale - Train MSE: 4187542.93, RMSE: $2046.35
  Price Scale - Val MSE: 682574029.00, RMSE: $26126.12

Starting Epoch [17/50]
Epoch [17/50] Summary:
  Normalized - Train MSE: 0.016866, RMSE: 0.129869
  Normalized - Val MSE: 0.161385, RMSE: 0.401727
  Price Scale - Train MSE: 3561194.40, RMSE: $1887.11
  Price Scale - Val MSE: 752155067.25, RMSE: $27425.45

Starting Epoch [18/50]
Epoch [18/50] Summary:
  Normalized - Train MSE: 0.016799, RMSE: 0.129609
  Normalized - Val MSE: 0.215893, RMSE: 0.464643
  Price Scale - Train MSE: 3437113.09, RMSE: $1853.95
  Price Scale - Val MSE: 866242806.91, RMSE: $29432.00

Starting Epoch [19/50]
Epoch [19/50] Summary:
  Normalized - Train MSE: 0.018143, RMSE: 0.134696
  Normalized - Val MSE: 0.282328, RMSE: 0.531346
  Price Scale - Train MSE: 4324252.72, RMSE: $2079.48
  Price Scale - Val MSE: 976396646.74, RMSE: $31247.35

Starting Epoch [20/50]

Attention Pattern Sample (Epoch 20):
Average attention weights: [[0.0024568 ]
 [0.00341315]
 [0.0034182 ]
 [0.00248171]
 [0.00242413]]
Epoch [20/50] Summary:
  Normalized - Train MSE: 0.018158, RMSE: 0.134753
  Normalized - Val MSE: 0.167572, RMSE: 0.409355
  Price Scale - Train MSE: 3323715.63, RMSE: $1823.11
  Price Scale - Val MSE: 767341939.44, RMSE: $27700.94

Starting Epoch [21/50]
Epoch [21/50] Summary:
  Normalized - Train MSE: 0.017380, RMSE: 0.131833
  Normalized - Val MSE: 0.152262, RMSE: 0.390207
  Price Scale - Train MSE: 3579699.78, RMSE: $1892.01
  Price Scale - Val MSE: 728965867.76, RMSE: $26999.37

Starting Epoch [22/50]
Epoch [22/50] Summary:
  Normalized - Train MSE: 0.016416, RMSE: 0.128125
  Normalized - Val MSE: 0.111821, RMSE: 0.334396
  Price Scale - Train MSE: 3337380.26, RMSE: $1826.85
  Price Scale - Val MSE: 619819892.89, RMSE: $24896.18

Starting Epoch [23/50]
Epoch [23/50] Summary:
  Normalized - Train MSE: 0.015734, RMSE: 0.125435
  Normalized - Val MSE: 0.118990, RMSE: 0.344950
  Price Scale - Train MSE: 3186828.74, RMSE: $1785.17
  Price Scale - Val MSE: 640880036.04, RMSE: $25315.61

Starting Epoch [24/50]
Epoch [24/50] Summary:
  Normalized - Train MSE: 0.016173, RMSE: 0.127172
  Normalized - Val MSE: 0.121815, RMSE: 0.349020
  Price Scale - Train MSE: 3073848.67, RMSE: $1753.24
  Price Scale - Val MSE: 649308709.09, RMSE: $25481.54

Starting Epoch [25/50]

Attention Pattern Sample (Epoch 25):
Average attention weights: [[0.00066566]
 [0.00149724]
 [0.00174352]
 [0.00120296]
 [0.00082245]]
Epoch [25/50] Summary:
  Normalized - Train MSE: 0.016099, RMSE: 0.126880
  Normalized - Val MSE: 0.102914, RMSE: 0.320802
  Price Scale - Train MSE: 3201527.34, RMSE: $1789.28
  Price Scale - Val MSE: 590792194.60, RMSE: $24306.22

Starting Epoch [26/50]
Epoch [26/50] Summary:
  Normalized - Train MSE: 0.015555, RMSE: 0.124722
  Normalized - Val MSE: 0.122577, RMSE: 0.350110
  Price Scale - Train MSE: 2951456.01, RMSE: $1717.98
  Price Scale - Val MSE: 647706970.34, RMSE: $25450.09

Starting Epoch [27/50]
Epoch [27/50] Summary:
  Normalized - Train MSE: 0.014529, RMSE: 0.120538
  Normalized - Val MSE: 0.146468, RMSE: 0.382711
  Price Scale - Train MSE: 3019702.88, RMSE: $1737.73
  Price Scale - Val MSE: 714671250.67, RMSE: $26733.34

Starting Epoch [28/50]
Epoch [28/50] Summary:
  Normalized - Train MSE: 0.015802, RMSE: 0.125708
  Normalized - Val MSE: 0.110347, RMSE: 0.332185
  Price Scale - Train MSE: 3188243.93, RMSE: $1785.57
  Price Scale - Val MSE: 615412137.58, RMSE: $24807.50

Starting Epoch [29/50]
Epoch [29/50] Summary:
  Normalized - Train MSE: 0.016829, RMSE: 0.129728
  Normalized - Val MSE: 0.123779, RMSE: 0.351822
  Price Scale - Train MSE: 3219742.22, RMSE: $1794.36
  Price Scale - Val MSE: 652047060.13, RMSE: $25535.21

Starting Epoch [30/50]

Attention Pattern Sample (Epoch 30):
Average attention weights: [[0.00044413]
 [0.0019721 ]
 [0.00312893]
 [0.00211563]
 [0.00143257]]
Epoch [30/50] Summary:
  Normalized - Train MSE: 0.013674, RMSE: 0.116936
  Normalized - Val MSE: 0.094523, RMSE: 0.307446
  Price Scale - Train MSE: 2984287.08, RMSE: $1727.51
  Price Scale - Val MSE: 562677238.25, RMSE: $23720.82

Starting Epoch [31/50]
Epoch [31/50] Summary:
  Normalized - Train MSE: 0.014346, RMSE: 0.119775
  Normalized - Val MSE: 0.134842, RMSE: 0.367208
  Price Scale - Train MSE: 3002600.92, RMSE: $1732.80
  Price Scale - Val MSE: 682843764.98, RMSE: $26131.28

Starting Epoch [32/50]
Epoch [32/50] Summary:
  Normalized - Train MSE: 0.014615, RMSE: 0.120893
  Normalized - Val MSE: 0.101280, RMSE: 0.318246
  Price Scale - Train MSE: 2910614.70, RMSE: $1706.05
  Price Scale - Val MSE: 584469198.55, RMSE: $24175.80

Starting Epoch [33/50]
Epoch [33/50] Summary:
  Normalized - Train MSE: 0.014134, RMSE: 0.118888
  Normalized - Val MSE: 0.098405, RMSE: 0.313696
  Price Scale - Train MSE: 3022422.91, RMSE: $1738.51
  Price Scale - Val MSE: 574477132.90, RMSE: $23968.25

Starting Epoch [34/50]
Epoch [34/50] Summary:
  Normalized - Train MSE: 0.014182, RMSE: 0.119090
  Normalized - Val MSE: 0.086827, RMSE: 0.294663
  Price Scale - Train MSE: 2912789.75, RMSE: $1706.69
  Price Scale - Val MSE: 533382532.56, RMSE: $23095.08

Starting Epoch [35/50]

Attention Pattern Sample (Epoch 35):
Average attention weights: [[0.00010649]
 [0.00138585]
 [0.00191462]
 [0.00117089]
 [0.00067108]]
Epoch [35/50] Summary:
  Normalized - Train MSE: 0.014809, RMSE: 0.121694
  Normalized - Val MSE: 0.120780, RMSE: 0.347534
  Price Scale - Train MSE: 2630524.33, RMSE: $1621.89
  Price Scale - Val MSE: 642725860.86, RMSE: $25352.04

Starting Epoch [36/50]
Epoch [36/50] Summary:
  Normalized - Train MSE: 0.015260, RMSE: 0.123532
  Normalized - Val MSE: 0.140325, RMSE: 0.374600
  Price Scale - Train MSE: 3055273.77, RMSE: $1747.93
  Price Scale - Val MSE: 696334924.84, RMSE: $26388.16

Starting Epoch [37/50]
Epoch [37/50] Summary:
  Normalized - Train MSE: 0.015773, RMSE: 0.125589
  Normalized - Val MSE: 0.071940, RMSE: 0.268216
  Price Scale - Train MSE: 2730886.21, RMSE: $1652.54
  Price Scale - Val MSE: 475964530.41, RMSE: $21816.61

Starting Epoch [38/50]
Epoch [38/50] Summary:
  Normalized - Train MSE: 0.015531, RMSE: 0.124623
  Normalized - Val MSE: 0.115003, RMSE: 0.339120
  Price Scale - Train MSE: 3456317.21, RMSE: $1859.12
  Price Scale - Val MSE: 627656123.26, RMSE: $25053.07

Starting Epoch [39/50]
Epoch [39/50] Summary:
  Normalized - Train MSE: 0.015646, RMSE: 0.125085
  Normalized - Val MSE: 0.128186, RMSE: 0.358030
  Price Scale - Train MSE: 2994577.84, RMSE: $1730.48
  Price Scale - Val MSE: 663754438.66, RMSE: $25763.43

Starting Epoch [40/50]

Attention Pattern Sample (Epoch 40):
Average attention weights: [[6.8692738e-05]
 [7.3554262e-04]
 [1.1462118e-03]
 [7.1274157e-04]
 [3.9095926e-04]]
Epoch [40/50] Summary:
  Normalized - Train MSE: 0.014389, RMSE: 0.119956
  Normalized - Val MSE: 0.102098, RMSE: 0.319527
  Price Scale - Train MSE: 2787076.92, RMSE: $1669.45
  Price Scale - Val MSE: 586297584.43, RMSE: $24213.58

Starting Epoch [41/50]
Epoch [41/50] Summary:
  Normalized - Train MSE: 0.015346, RMSE: 0.123878
  Normalized - Val MSE: 0.111671, RMSE: 0.334172
  Price Scale - Train MSE: 2820782.25, RMSE: $1679.52
  Price Scale - Val MSE: 616277428.29, RMSE: $24824.94

Starting Epoch [42/50]
Epoch [42/50] Summary:
  Normalized - Train MSE: 0.013875, RMSE: 0.117790
  Normalized - Val MSE: 0.127583, RMSE: 0.357188
  Price Scale - Train MSE: 2820275.67, RMSE: $1679.37
  Price Scale - Val MSE: 663667570.42, RMSE: $25761.75

Starting Epoch [43/50]
Epoch [43/50] Summary:
  Normalized - Train MSE: 0.014058, RMSE: 0.118567
  Normalized - Val MSE: 0.097031, RMSE: 0.311498
  Price Scale - Train MSE: 2968473.76, RMSE: $1722.93
  Price Scale - Val MSE: 570687483.91, RMSE: $23889.07

Starting Epoch [44/50]
Epoch [44/50] Summary:
  Normalized - Train MSE: 0.014251, RMSE: 0.119378
  Normalized - Val MSE: 0.134615, RMSE: 0.366899
  Price Scale - Train MSE: 2803999.36, RMSE: $1674.51
  Price Scale - Val MSE: 682977791.15, RMSE: $26133.84

Starting Epoch [45/50]

Attention Pattern Sample (Epoch 45):
Average attention weights: [[5.2655610e-05]
 [1.6637676e-03]
 [4.4918703e-03]
 [1.9134564e-03]
 [1.2846681e-03]]
Epoch [45/50] Summary:
  Normalized - Train MSE: 0.014676, RMSE: 0.121145
  Normalized - Val MSE: 0.081053, RMSE: 0.284698
  Price Scale - Train MSE: 2654761.99, RMSE: $1629.34
  Price Scale - Val MSE: 512976362.64, RMSE: $22648.98

Starting Epoch [46/50]
Epoch [46/50] Summary:
  Normalized - Train MSE: 0.014969, RMSE: 0.122349
  Normalized - Val MSE: 0.068472, RMSE: 0.261671
  Price Scale - Train MSE: 2825271.07, RMSE: $1680.85
  Price Scale - Val MSE: 462028843.34, RMSE: $21494.86

Starting Epoch [47/50]
Epoch [47/50] Summary:
  Normalized - Train MSE: 0.014226, RMSE: 0.119271
  Normalized - Val MSE: 0.098445, RMSE: 0.313759
  Price Scale - Train MSE: 2678049.28, RMSE: $1636.47
  Price Scale - Val MSE: 574023188.86, RMSE: $23958.78

Starting Epoch [48/50]
Epoch [48/50] Summary:
  Normalized - Train MSE: 0.015097, RMSE: 0.122871
  Normalized - Val MSE: 0.097829, RMSE: 0.312776
  Price Scale - Train MSE: 2805629.79, RMSE: $1675.00
  Price Scale - Val MSE: 571372826.31, RMSE: $23903.41

Starting Epoch [49/50]
Epoch [49/50] Summary:
  Normalized - Train MSE: 0.013031, RMSE: 0.114152
  Normalized - Val MSE: 0.119901, RMSE: 0.346267
  Price Scale - Train MSE: 2379586.79, RMSE: $1542.59
  Price Scale - Val MSE: 639530339.85, RMSE: $25288.94

Starting Epoch [50/50]

Attention Pattern Sample (Epoch 50):
Average attention weights: [[3.4730569e-05]
 [6.0706533e-04]
 [1.1895564e-03]
 [7.4716529e-04]
 [3.7352424e-04]]
Epoch [50/50] Summary:
  Normalized - Train MSE: 0.014711, RMSE: 0.121290
  Normalized - Val MSE: 0.095870, RMSE: 0.309629
  Price Scale - Train MSE: 2691434.74, RMSE: $1640.56
  Price Scale - Val MSE: 564246601.36, RMSE: $23753.88
Training completed in 806.85 seconds
Saving model and results...
Starting evaluation process...
Generating predictions...
Creating visualizations...
Training history plot saved
Prediction analysis plots saved
Metrics and sample predictions tables saved
Error distribution and time series plots saved
Creating attention visualizations...
Attention visualization plots saved
Evaluation metrics (for test set):
  Mean Squared Error ($): 816017027.35
  Root Mean Squared Error ($): 28566.01
  Mean Absolute Error ($): 23875.59
  Mean Absolute Percentage Error (%): 48.60
  Weighted MAPE (%): 54.90
  Directional Accuracy (%): 48.87
  Maximum Absolute Error ($): 51096.59
  Mean Percentage Error (%): 48.60
  R² Score: -1.74
