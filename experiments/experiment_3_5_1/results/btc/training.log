=== Starting new training run ===
Crypto Currency: btc

Model Parameters:
  hidden_size: 128
  num_layers: 2
  dropout: 0.2
  num_epochs: 50
  batch_size: 32
  learning_rate: 0.001
  device: cpu
  weight_decay: 1e-05
  betas: (0.9, 0.999)
  eps: 1e-08
  criterion: MSE
Loading pre-processed data...

=== Dataset Configuration ===
Sequence length: 60
Feature count: 5
Feature indices: {'Volume': 0, 'Open': 1, 'High': 2, 'Low': 3, 'Close': 4}
Close price index: 4

=== Data Shapes ===
Training set shape: torch.Size([3316, 60, 5])
Validation set shape: torch.Size([663, 60, 5])
Test set shape: torch.Size([664, 60, 5])

=== Date Range ===
Start date: 2011-08-18
End date: 2024-10-30

=== Feature Alignment Verification ===
Feature alignment test - Close position: 4
Inverse transform test shape: (1, 5)
Model input size: 5
Starting training process...
Starting training process
Model architecture:
AdvancedPricePredictionModel(
  (lstm): EnhancedLSTM(
    (input_embedding): Linear(in_features=5, out_features=128, bias=True)
    (lstm_cells): ModuleList(
      (0-1): 2 x CustomLSTMCell(
        (dropout): Dropout(p=0.2, inplace=False)
        (layer_norm_1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (layer_norm_2): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (gates): Linear(in_features=256, out_features=512, bias=True)
      )
    )
    (attention): AttentionLayer(
      (attention): Sequential(
        (0): Linear(in_features=128, out_features=128, bias=True)
        (1): Tanh()
        (2): Linear(in_features=128, out_features=1, bias=True)
      )
    )
    (positional_encoding): PositionalEncoding()
    (self_attention): MultiHeadSelfAttention(
      (q_linear): Linear(in_features=128, out_features=128, bias=True)
      (k_linear): Linear(in_features=128, out_features=128, bias=True)
      (v_linear): Linear(in_features=128, out_features=128, bias=True)
      (dropout): Dropout(p=0.1, inplace=False)
      (out): Linear(in_features=128, out_features=128, bias=True)
    )
    (glu): GatedLinearUnit(
      (linear): Linear(in_features=128, out_features=256, bias=True)
    )
    (temporal_conv): TemporalConvNet(
      (conv1): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
      (conv2): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
      (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    (skip_connections): ModuleList(
      (0-1): 2 x Linear(in_features=128, out_features=128, bias=True)
    )
  )
  (prediction_head): Sequential(
    (0): Linear(in_features=128, out_features=128, bias=True)
    (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    (2): ReLU()
    (3): Dropout(p=0.2, inplace=False)
    (4): Linear(in_features=128, out_features=64, bias=True)
    (5): ReLU()
    (6): Dropout(p=0.2, inplace=False)
    (7): Linear(in_features=64, out_features=1, bias=True)
  )
)
Training parameters: epochs=50, device=cpu
Optimizer: Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.001
    maximize: False
    weight_decay: 1e-05
)
Loss function: MSELoss()
Training batches: 104
Validation batches: 21

Starting Epoch [1/50]

First batch details:
Scaled predictions (first 3):
[[ 0.01447694]
 [-0.0150084 ]
 [ 0.0898972 ]]
Scaled targets (first 3):
[ 0.5820292  -0.02488857 -0.00956878]
Price predictions (first 3):
[ 707.42449139  524.19717767 1176.09975266]
Price targets (first 3):
[4234.29794947  462.80005479  558.00000082]
Initial normalized MSE: 0.844307
Initial price-scale MSE: 32603821.47
Epoch [1/50] Summary:
  Normalized - Train MSE: 0.063772, RMSE: 0.252532
  Normalized - Val MSE: 21.468736, RMSE: 4.633437
  Price Scale - Train MSE: 2462630.84, RMSE: $1569.28
  Price Scale - Val MSE: 829038062.24, RMSE: $28793.02

Starting Epoch [2/50]
Epoch [2/50] Summary:
  Normalized - Train MSE: 0.022339, RMSE: 0.149462
  Normalized - Val MSE: 19.291621, RMSE: 4.392223
  Price Scale - Train MSE: 862636.88, RMSE: $928.78
  Price Scale - Val MSE: 744966473.35, RMSE: $27294.07

Starting Epoch [3/50]
Epoch [3/50] Summary:
  Normalized - Train MSE: 0.015092, RMSE: 0.122851
  Normalized - Val MSE: 18.167755, RMSE: 4.262365
  Price Scale - Train MSE: 582807.48, RMSE: $763.42
  Price Scale - Val MSE: 701567185.08, RMSE: $26487.11

Starting Epoch [4/50]
Epoch [4/50] Summary:
  Normalized - Train MSE: 0.014297, RMSE: 0.119570
  Normalized - Val MSE: 17.519550, RMSE: 4.185636
  Price Scale - Train MSE: 552091.18, RMSE: $743.03
  Price Scale - Val MSE: 676536061.19, RMSE: $26010.31

Starting Epoch [5/50]

Attention Pattern Sample (Epoch 5):
Average attention weights: [[0.00011495]
 [0.00018182]
 [0.00019449]
 [0.00014397]
 [0.00010095]]
Epoch [5/50] Summary:
  Normalized - Train MSE: 0.014920, RMSE: 0.122148
  Normalized - Val MSE: 19.089328, RMSE: 4.369134
  Price Scale - Train MSE: 576156.36, RMSE: $759.05
  Price Scale - Val MSE: 737154703.18, RMSE: $27150.59

Starting Epoch [6/50]
Epoch [6/50] Summary:
  Normalized - Train MSE: 0.013254, RMSE: 0.115125
  Normalized - Val MSE: 17.440983, RMSE: 4.176240
  Price Scale - Train MSE: 511805.82, RMSE: $715.41
  Price Scale - Val MSE: 673502134.85, RMSE: $25951.92

Starting Epoch [7/50]
Epoch [7/50] Summary:
  Normalized - Train MSE: 0.013818, RMSE: 0.117548
  Normalized - Val MSE: 16.700916, RMSE: 4.086675
  Price Scale - Train MSE: 533579.07, RMSE: $730.46
  Price Scale - Val MSE: 644923632.77, RMSE: $25395.35

Starting Epoch [8/50]
Epoch [8/50] Summary:
  Normalized - Train MSE: 0.012084, RMSE: 0.109929
  Normalized - Val MSE: 15.679473, RMSE: 3.959731
  Price Scale - Train MSE: 466649.31, RMSE: $683.12
  Price Scale - Val MSE: 605479542.33, RMSE: $24606.49

Starting Epoch [9/50]
Epoch [9/50] Summary:
  Normalized - Train MSE: 0.013376, RMSE: 0.115657
  Normalized - Val MSE: 16.807092, RMSE: 4.099645
  Price Scale - Train MSE: 516546.71, RMSE: $718.71
  Price Scale - Val MSE: 649023749.30, RMSE: $25475.94

Starting Epoch [10/50]

Attention Pattern Sample (Epoch 10):
Average attention weights: [[0.00097189]
 [0.00103429]
 [0.00069234]
 [0.00033258]
 [0.00016843]]
Epoch [10/50] Summary:
  Normalized - Train MSE: 0.012926, RMSE: 0.113692
  Normalized - Val MSE: 18.474440, RMSE: 4.298190
  Price Scale - Train MSE: 499144.47, RMSE: $706.50
  Price Scale - Val MSE: 713410184.31, RMSE: $26709.74

Starting Epoch [11/50]
Epoch [11/50] Summary:
  Normalized - Train MSE: 0.014259, RMSE: 0.119412
  Normalized - Val MSE: 17.434505, RMSE: 4.175465
  Price Scale - Train MSE: 550633.60, RMSE: $742.05
  Price Scale - Val MSE: 673251963.19, RMSE: $25947.10

Starting Epoch [12/50]
Epoch [12/50] Summary:
  Normalized - Train MSE: 0.012532, RMSE: 0.111945
  Normalized - Val MSE: 18.742011, RMSE: 4.329204
  Price Scale - Train MSE: 483921.49, RMSE: $695.64
  Price Scale - Val MSE: 723742705.72, RMSE: $26902.47

Starting Epoch [13/50]
Epoch [13/50] Summary:
  Normalized - Train MSE: 0.011607, RMSE: 0.107734
  Normalized - Val MSE: 17.199504, RMSE: 4.147228
  Price Scale - Train MSE: 448198.81, RMSE: $669.48
  Price Scale - Val MSE: 664177139.92, RMSE: $25771.63

Starting Epoch [14/50]
Epoch [14/50] Summary:
  Normalized - Train MSE: 0.011873, RMSE: 0.108964
  Normalized - Val MSE: 16.613385, RMSE: 4.075952
  Price Scale - Train MSE: 458492.79, RMSE: $677.12
  Price Scale - Val MSE: 641543549.52, RMSE: $25328.71

Starting Epoch [15/50]

Attention Pattern Sample (Epoch 15):
Average attention weights: [[0.00445844]
 [0.0020264 ]
 [0.0010015 ]
 [0.00042264]
 [0.00019064]]
Epoch [15/50] Summary:
  Normalized - Train MSE: 0.012146, RMSE: 0.110210
  Normalized - Val MSE: 17.081944, RMSE: 4.133031
  Price Scale - Train MSE: 469043.49, RMSE: $684.87
  Price Scale - Val MSE: 659637428.80, RMSE: $25683.41

Starting Epoch [16/50]
Epoch [16/50] Summary:
  Normalized - Train MSE: 0.011596, RMSE: 0.107686
  Normalized - Val MSE: 15.964011, RMSE: 3.995499
  Price Scale - Train MSE: 447804.72, RMSE: $669.18
  Price Scale - Val MSE: 616467295.90, RMSE: $24828.76

Starting Epoch [17/50]
Epoch [17/50] Summary:
  Normalized - Train MSE: 0.010410, RMSE: 0.102027
  Normalized - Val MSE: 17.154101, RMSE: 4.141751
  Price Scale - Train MSE: 401975.90, RMSE: $634.02
  Price Scale - Val MSE: 662423874.46, RMSE: $25737.60

Starting Epoch [18/50]
Epoch [18/50] Summary:
  Normalized - Train MSE: 0.011559, RMSE: 0.107513
  Normalized - Val MSE: 16.172703, RMSE: 4.021530
  Price Scale - Train MSE: 446361.63, RMSE: $668.10
  Price Scale - Val MSE: 624526152.81, RMSE: $24990.52

Starting Epoch [19/50]
Epoch [19/50] Summary:
  Normalized - Train MSE: 0.011711, RMSE: 0.108218
  Normalized - Val MSE: 17.598472, RMSE: 4.195053
  Price Scale - Train MSE: 452239.23, RMSE: $672.49
  Price Scale - Val MSE: 679583721.71, RMSE: $26068.83

Starting Epoch [20/50]

Attention Pattern Sample (Epoch 20):
Average attention weights: [[0.01157266]
 [0.00236448]
 [0.00091454]
 [0.00030584]
 [0.00014846]]
Epoch [20/50] Summary:
  Normalized - Train MSE: 0.010537, RMSE: 0.102651
  Normalized - Val MSE: 17.590365, RMSE: 4.194087
  Price Scale - Train MSE: 406905.33, RMSE: $637.89
  Price Scale - Val MSE: 679270651.64, RMSE: $26062.82

Starting Epoch [21/50]
Epoch [21/50] Summary:
  Normalized - Train MSE: 0.009642, RMSE: 0.098192
  Normalized - Val MSE: 17.596557, RMSE: 4.194825
  Price Scale - Train MSE: 372324.77, RMSE: $610.18
  Price Scale - Val MSE: 679509774.39, RMSE: $26067.41

Starting Epoch [22/50]
Epoch [22/50] Summary:
  Normalized - Train MSE: 0.010314, RMSE: 0.101559
  Normalized - Val MSE: 17.104737, RMSE: 4.135787
  Price Scale - Train MSE: 398294.48, RMSE: $631.11
  Price Scale - Val MSE: 660517620.35, RMSE: $25700.54

Starting Epoch [23/50]
Epoch [23/50] Summary:
  Normalized - Train MSE: 0.009687, RMSE: 0.098422
  Normalized - Val MSE: 17.053370, RMSE: 4.129573
  Price Scale - Train MSE: 374068.75, RMSE: $611.61
  Price Scale - Val MSE: 658534015.81, RMSE: $25661.92

Starting Epoch [24/50]
Epoch [24/50] Summary:
  Normalized - Train MSE: 0.011111, RMSE: 0.105407
  Normalized - Val MSE: 16.743537, RMSE: 4.091887
  Price Scale - Train MSE: 429051.58, RMSE: $655.02
  Price Scale - Val MSE: 646569475.26, RMSE: $25427.73

Starting Epoch [25/50]

Attention Pattern Sample (Epoch 25):
Average attention weights: [[0.01976766]
 [0.0052855 ]
 [0.00231042]
 [0.00099226]
 [0.00046665]]
Epoch [25/50] Summary:
  Normalized - Train MSE: 0.009490, RMSE: 0.097418
  Normalized - Val MSE: 17.510620, RMSE: 4.184569
  Price Scale - Train MSE: 366476.14, RMSE: $605.37
  Price Scale - Val MSE: 676191225.69, RMSE: $26003.68

Starting Epoch [26/50]
Epoch [26/50] Summary:
  Normalized - Train MSE: 0.010235, RMSE: 0.101169
  Normalized - Val MSE: 17.233781, RMSE: 4.151359
  Price Scale - Train MSE: 395241.70, RMSE: $628.68
  Price Scale - Val MSE: 665500814.63, RMSE: $25797.30

Starting Epoch [27/50]
Epoch [27/50] Summary:
  Normalized - Train MSE: 0.009429, RMSE: 0.097101
  Normalized - Val MSE: 16.515736, RMSE: 4.063956
  Price Scale - Train MSE: 364098.99, RMSE: $603.41
  Price Scale - Val MSE: 637772709.04, RMSE: $25254.16

Starting Epoch [28/50]
Epoch [28/50] Summary:
  Normalized - Train MSE: 0.010237, RMSE: 0.101178
  Normalized - Val MSE: 16.793679, RMSE: 4.098009
  Price Scale - Train MSE: 395313.90, RMSE: $628.74
  Price Scale - Val MSE: 648505766.81, RMSE: $25465.78

Starting Epoch [29/50]
Epoch [29/50] Summary:
  Normalized - Train MSE: 0.008899, RMSE: 0.094332
  Normalized - Val MSE: 16.527860, RMSE: 4.065447
  Price Scale - Train MSE: 343628.66, RMSE: $586.20
  Price Scale - Val MSE: 638240896.97, RMSE: $25263.43

Starting Epoch [30/50]

Attention Pattern Sample (Epoch 30):
Average attention weights: [[0.00949045]
 [0.00250141]
 [0.00156762]
 [0.00083712]
 [0.00042469]]
Epoch [30/50] Summary:
  Normalized - Train MSE: 0.008990, RMSE: 0.094814
  Normalized - Val MSE: 16.427530, RMSE: 4.053089
  Price Scale - Train MSE: 347149.97, RMSE: $589.19
  Price Scale - Val MSE: 634366556.58, RMSE: $25186.63

Starting Epoch [31/50]
Epoch [31/50] Summary:
  Normalized - Train MSE: 0.009512, RMSE: 0.097530
  Normalized - Val MSE: 15.591231, RMSE: 3.948573
  Price Scale - Train MSE: 367323.55, RMSE: $606.07
  Price Scale - Val MSE: 602071982.32, RMSE: $24537.16

Starting Epoch [32/50]
Epoch [32/50] Summary:
  Normalized - Train MSE: 0.010428, RMSE: 0.102118
  Normalized - Val MSE: 15.918118, RMSE: 3.989752
  Price Scale - Train MSE: 402695.34, RMSE: $634.58
  Price Scale - Val MSE: 614695075.69, RMSE: $24793.04

Starting Epoch [33/50]
Epoch [33/50] Summary:
  Normalized - Train MSE: 0.009783, RMSE: 0.098908
  Normalized - Val MSE: 17.126893, RMSE: 4.138465
  Price Scale - Train MSE: 377774.53, RMSE: $614.63
  Price Scale - Val MSE: 661373178.82, RMSE: $25717.18

Starting Epoch [34/50]
Epoch [34/50] Summary:
  Normalized - Train MSE: 0.010091, RMSE: 0.100455
  Normalized - Val MSE: 17.250207, RMSE: 4.153337
  Price Scale - Train MSE: 389685.30, RMSE: $624.25
  Price Scale - Val MSE: 666135107.26, RMSE: $25809.59

Starting Epoch [35/50]

Attention Pattern Sample (Epoch 35):
Average attention weights: [[2.0132209e-05]
 [3.4841358e-07]
 [1.7398262e-08]
 [9.1886124e-11]
 [6.9374111e-12]]
Epoch [35/50] Summary:
  Normalized - Train MSE: 0.009491, RMSE: 0.097423
  Normalized - Val MSE: 16.341797, RMSE: 4.042499
  Price Scale - Train MSE: 366515.62, RMSE: $605.41
  Price Scale - Val MSE: 631055863.62, RMSE: $25120.83

Starting Epoch [36/50]
Epoch [36/50] Summary:
  Normalized - Train MSE: 0.008964, RMSE: 0.094678
  Normalized - Val MSE: 15.364307, RMSE: 3.919733
  Price Scale - Train MSE: 346154.89, RMSE: $588.35
  Price Scale - Val MSE: 593309083.03, RMSE: $24357.94

Starting Epoch [37/50]
Epoch [37/50] Summary:
  Normalized - Train MSE: 0.009090, RMSE: 0.095342
  Normalized - Val MSE: 15.737931, RMSE: 3.967106
  Price Scale - Train MSE: 351022.85, RMSE: $592.47
  Price Scale - Val MSE: 607736943.65, RMSE: $24652.32

Starting Epoch [38/50]
Epoch [38/50] Summary:
  Normalized - Train MSE: 0.009449, RMSE: 0.097205
  Normalized - Val MSE: 16.507496, RMSE: 4.062942
  Price Scale - Train MSE: 364876.89, RMSE: $604.05
  Price Scale - Val MSE: 637454510.22, RMSE: $25247.86

Starting Epoch [39/50]
Epoch [39/50] Summary:
  Normalized - Train MSE: 0.009654, RMSE: 0.098253
  Normalized - Val MSE: 16.185764, RMSE: 4.023153
  Price Scale - Train MSE: 372784.52, RMSE: $610.56
  Price Scale - Val MSE: 625030471.84, RMSE: $25000.61

Starting Epoch [40/50]

Attention Pattern Sample (Epoch 40):
Average attention weights: [[5.9244310e-04]
 [5.9331651e-05]
 [9.7843358e-06]
 [1.0787417e-06]
 [1.0380203e-07]]
Epoch [40/50] Summary:
  Normalized - Train MSE: 0.007937, RMSE: 0.089088
  Normalized - Val MSE: 17.727599, RMSE: 4.210416
  Price Scale - Train MSE: 306480.13, RMSE: $553.61
  Price Scale - Val MSE: 684570097.39, RMSE: $26164.29

Starting Epoch [41/50]
Epoch [41/50] Summary:
  Normalized - Train MSE: 0.008950, RMSE: 0.094605
  Normalized - Val MSE: 16.280099, RMSE: 4.034860
  Price Scale - Train MSE: 345614.25, RMSE: $587.89
  Price Scale - Val MSE: 628673326.20, RMSE: $25073.36

Starting Epoch [42/50]
Epoch [42/50] Summary:
  Normalized - Train MSE: 0.009164, RMSE: 0.095731
  Normalized - Val MSE: 16.355237, RMSE: 4.044161
  Price Scale - Train MSE: 353895.81, RMSE: $594.89
  Price Scale - Val MSE: 631574863.12, RMSE: $25131.15

Starting Epoch [43/50]
Epoch [43/50] Summary:
  Normalized - Train MSE: 0.008390, RMSE: 0.091596
  Normalized - Val MSE: 15.661158, RMSE: 3.957418
  Price Scale - Train MSE: 323981.50, RMSE: $569.19
  Price Scale - Val MSE: 604772260.33, RMSE: $24592.12

Starting Epoch [44/50]
Epoch [44/50] Summary:
  Normalized - Train MSE: 0.009344, RMSE: 0.096667
  Normalized - Val MSE: 16.282532, RMSE: 4.035162
  Price Scale - Train MSE: 360847.39, RMSE: $600.71
  Price Scale - Val MSE: 628767326.31, RMSE: $25075.23

Starting Epoch [45/50]

Attention Pattern Sample (Epoch 45):
Average attention weights: [[1.9766984e-03]
 [7.1778799e-05]
 [1.7388667e-05]
 [4.2704728e-06]
 [1.1425183e-06]]
Epoch [45/50] Summary:
  Normalized - Train MSE: 0.008241, RMSE: 0.090778
  Normalized - Val MSE: 15.791866, RMSE: 3.973898
  Price Scale - Train MSE: 318221.18, RMSE: $564.11
  Price Scale - Val MSE: 609819730.61, RMSE: $24694.53

Starting Epoch [46/50]
Epoch [46/50] Summary:
  Normalized - Train MSE: 0.008348, RMSE: 0.091367
  Normalized - Val MSE: 15.395004, RMSE: 3.923647
  Price Scale - Train MSE: 322367.19, RMSE: $567.77
  Price Scale - Val MSE: 594494481.12, RMSE: $24382.26

Starting Epoch [47/50]
Epoch [47/50] Summary:
  Normalized - Train MSE: 0.008644, RMSE: 0.092971
  Normalized - Val MSE: 16.937387, RMSE: 4.115506
  Price Scale - Train MSE: 333783.32, RMSE: $577.74
  Price Scale - Val MSE: 654055194.95, RMSE: $25574.50

Starting Epoch [48/50]
Epoch [48/50] Summary:
  Normalized - Train MSE: 0.008309, RMSE: 0.091152
  Normalized - Val MSE: 15.618368, RMSE: 3.952008
  Price Scale - Train MSE: 320849.90, RMSE: $566.44
  Price Scale - Val MSE: 603119930.45, RMSE: $24558.50

Starting Epoch [49/50]
Epoch [49/50] Summary:
  Normalized - Train MSE: 0.007854, RMSE: 0.088621
  Normalized - Val MSE: 14.860821, RMSE: 3.854974
  Price Scale - Train MSE: 303276.00, RMSE: $550.71
  Price Scale - Val MSE: 573866435.88, RMSE: $23955.51

Starting Epoch [50/50]

Attention Pattern Sample (Epoch 50):
Average attention weights: [[1.1117222e-03]
 [1.8616924e-04]
 [9.1181479e-05]
 [4.3010637e-05]
 [2.1512678e-05]]
Epoch [50/50] Summary:
  Normalized - Train MSE: 0.008296, RMSE: 0.091080
  Normalized - Val MSE: 15.441370, RMSE: 3.929551
  Price Scale - Train MSE: 320345.10, RMSE: $565.99
  Price Scale - Val MSE: 596284906.10, RMSE: $24418.95
Training completed in 1029.70 seconds
Saving model and results...
Starting evaluation process...
Generating predictions...
Creating visualizations...
Training history plot saved
Prediction analysis plots saved
Metrics and sample predictions tables saved
Error distribution and time series plots saved
Creating attention visualizations...
Attention visualization plots saved
Evaluation metrics (for test set):
  Mean Squared Error ($): 909600333.54
  Root Mean Squared Error ($): 30159.58
  Mean Absolute Error ($): 25076.56
  Mean Absolute Percentage Error (%): 50.75
  Weighted MAPE (%): 57.67
  Directional Accuracy (%): 50.83
  Maximum Absolute Error ($): 54114.46
  Mean Percentage Error (%): 50.75
  R² Score: -2.05
